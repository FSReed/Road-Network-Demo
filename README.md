# 城市路网结构可视化 DEMO

## 项目简介

本项目是一个基于 D3.js 的交互式城市路网结构可视化 DEMO。采用模块化设计，实现了自然风格、结构多样的城市路网图生成与展示。支持一键生成新样例和导出当前样例数据，适用于城市交通可视化演示场景。

## 技术栈

- **前端框架**：原生 JavaScript + D3.js v7
- **项目结构**：模块化设计，ES6+ 类
- **构建工具**：原生开发，支持后续集成构建工具
- **依赖管理**：无外部依赖（除 D3.js）

## 项目结构

```
.
├── public/
│   └── index.html          # 主HTML文件
├── src/
│   ├── css/
│   │   └── styles.css      # 样式定义
│   ├── js/
│   │   ├── config.js       # 配置参数
│   │   ├── graphGenerator.js # 图形生成逻辑
│   │   ├── renderer.js     # 图形渲染逻辑
│   │   ├── controls.js     # 交互控制逻辑
│   │   └── main.js         # 程序入口
│   └── components/         # 组件目录（预留）
└── README.md              # 项目文档
```

## 核心模块说明

### 1. 图形生成器 (GraphGenerator)

负责生成路网结构数据，包含以下核心功能：

- **泊松盘采样**：生成自然分布的节点
- **Delaunay三角剖分**：生成基础边结构
- **边优化**：随机去除部分边，增加自然感
- **折线生成**：为边添加中间点，模拟真实道路弯曲

### 2. 渲染器 (GraphRenderer)

负责图形渲染和交互，主要功能：

- **SVG渲染**：使用 D3.js 渲染节点和边
- **缩放控制**：支持鼠标滚轮缩放和拖拽平移
- **提示框**：显示节点、边和中间点的详细信息
- **自适应布局**：自动调整视图以适应图形大小

### 3. 控制器 (GraphControls)

处理用户交互和数据导出：

- **按钮事件**：处理生成新样例和导出功能
- **缩放控制**：提供放大、缩小、重置视图功能
- **数据导出**：支持导出当前图形为 JSON 格式

### 4. 配置管理 (Config)

集中管理所有配置参数：

- **画布配置**：尺寸、边距等
- **图形参数**：节点距离、采样次数等
- **样式设置**：颜色、大小、透明度等
- **交互参数**：缩放范围、动画时长等

## 主要特性

### 1. 路网生成

- **自然节点分布**：采用泊松盘采样算法，确保节点分布均匀但不规则
- **多样边结构**：基于 Delaunay 三角剖分，支持多种路网形态
- **折线边支持**：每条边包含多个中间点，模拟真实道路弯曲
- **随机优化**：随机去除部分边，增加路网的自然感

### 2. 交互体验

- **属性悬停显示**：
  - 节点：显示 ID 和坐标
  - 边：显示连接的源节点和目标节点
  - 中间点：显示坐标信息
- **视图控制**：
  - 鼠标滚轮缩放
  - 拖拽平移
  - 控制按钮（放大、缩小、重置）
- **样例管理**：
  - 一键生成新样例
  - 导出当前样例为 JSON

### 3. 视觉设计

- **深色主题**：
  - 背景色：`#1f1e33`
  - 节点颜色：`#ff6b6b`
  - 边颜色：`#4a9eff`
- **现代化UI**：
  - 圆角设计
  - 半透明效果
  - SVG 图标
  - 悬停动画

## 数据格式

导出的 JSON 文件结构：

```json
{
  "nodes": [
    { "id": 0, "x": 123, "y": 456 },
    ...
  ],
  "edges": [
    {
      "source": 0,
      "target": 1,
      "points": [
        { "x": 123, "y": 456 },
        { "x": 150, "y": 470 },
        { "x": 200, "y": 500 }
      ]
    },
    ...
  ]
}
```

## 使用方法

1. **运行项目**
   - 直接在浏览器中打开 `public/index.html`
   - 支持所有现代浏览器（推荐 Chrome/Edge/Firefox）

2. **交互操作**
   - 鼠标滚轮：缩放视图
   - 拖拽：平移视图
   - 悬停：查看详细信息
   - 按钮：控制视图和样例

3. **样例管理**
   - 点击"生成新样例"：创建新的路网结构
   - 点击"导出当前样例"：保存当前图形数据

## 扩展方向

1. **功能扩展**
   - 节点/边属性编辑
   - 路径高亮和搜索
   - 更多路网生成算法
   - 性能优化

2. **技术升级**
   - 集成构建工具（Webpack/Vite）
   - 添加单元测试
   - 支持 TypeScript
   - 集成后端服务

3. **UI/UX 改进**
   - 更多主题支持
   - 自定义样式配置
   - 动画效果增强
   - 响应式设计优化

## 开发指南

1. **环境准备**
   - 现代浏览器
   - 代码编辑器（推荐 VS Code）

2. **代码规范**
   - 使用 ES6+ 语法
   - 遵循模块化设计
   - 保持代码注释完整

3. **调试方法**
   - 使用浏览器开发者工具
   - 查看控制台输出
   - 检查网络请求

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进项目。提交代码时请：

1. 遵循现有的代码风格
2. 添加必要的注释
3. 确保代码可运行
4. 更新相关文档

## 版权说明

本项目采用 MIT 许可证，可自由用于学习、研究和二次开发。

---

*如有问题或建议，欢迎提出！*


---

## 技术方案

- **前端可视化**：D3.js v7
- **节点生成**：泊松盘采样算法（Poisson Disk Sampling）
- **边生成**：Delaunay 三角剖分（d3.Delaunay）
- **数据导出**：前端生成 JSON 并触发下载
- **无后端依赖**：所有数据均在前端生成和处理，无需外部数据文件

---

## 文件结构

```
.
├── Example.html   # 主页面，包含全部可视化、交互、样例生成与导出逻辑
├── README.md      # 项目说明文档
```

---

## 使用方法

1. **打开页面**  
   使用现代浏览器（推荐 Chrome/Edge/Firefox）直接打开 `Example.html` 文件。

2. **交互操作**  
   - 鼠标滚轮缩放，拖拽平移视图。
   - 右下角按钮可放大、缩小、重置视图。
   - 鼠标悬停节点、边或中间点可查看详细信息。

3. **生成与导出样例**  
   - 点击右上角"生成新样例"按钮，自动生成新的城市路网结构。
   - 如需保存当前样例，点击右上角"导出当前样例"按钮，即可下载当前节点和边的 JSON 文件。

---

## 数据格式说明

导出的 JSON 文件结构如下：

```json
{
  "nodes": [
    { "id": 0, "x": 123, "y": 456 },
    ...
  ],
  "edges": [
    {
      "source": 0,
      "target": 1,
      "points": [
        { "x": 123, "y": 456 },
        { "x": 150, "y": 470 },
        { "x": 200, "y": 500 }
      ]
    },
    ...
  ]
}
```
- `nodes`：每个节点包含唯一 `id` 及其坐标 `x, y`。
- `edges`：每条边包含起止节点 `source, target` 及折线路径 `points`（首尾为端点，中间为折点）。

---

## 可扩展方向

- 支持节点/边属性编辑与动态交互
- 节点拖拽、路径高亮、搜索过滤等高级交互
- 更丰富的路网生成算法（如规则格网、分层路网等）
- 性能优化，支持大规模路网渲染
- 导入外部数据、与后端联动等

---

## 版权与许可

本项目可自由用于学习、研究和二次开发。欢迎提出建议和贡献改进！

---
